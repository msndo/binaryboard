<!DOCTYPE html>
<html lang="ja" id="html">
<head>
<meta charset="utf-8">
<title>足し算</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="keywords" content="">
<meta name="description" content="">
<link rel="stylesheet" type="text/css" media="screen, tv, print" href="css/style.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.0/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@barba/core"></script>
<script src="js/script.js"></script>
</head>

<body data-barba="wrapper">
<div class="appdemoBinarySwitch" data-barba="container" data-barba-namespace="general">
<header class="containerTitlePage">
<h1 class="titlePage">足し算</h1>
<p class="tagline">Calculate Addition</p>

<nav class="containerNavGlobal">
<ul class="navGlobal">
<li><a class="contentNavGlobal" href="./">0/1 スイッチボード</a></li>
<li><a class="contentNavGlobal" href="./switchimage.html">2画像切り替えるだけ</a></li>
<li><a class="contentNavGlobal" href="./bindimage.html">十二支画像を割り当てる</a></li>
<li><a class="contentNavGlobal" href="./color.html">24ビットカラーコード</a></li>
<li><a class="contentNavGlobal" href="./add.html">足し算</a></li>
<li><a class="contentNavGlobal" href="./alloc.html">メモリ割当</a></li>
<li><a class="contentNavGlobal" href="./console.html">コンソールができた</a></li>
</ul>
</nav>
</header>


<main class="demoAddition">
<img class="preload" src="img/switch_denki_dentou_on.png" alt="">
<img class="preload" src="img/small_star7_yellow.png" alt="">

<div class="crusterSwitch valueFrom">
<div class="containerBitWithIncDec">
<div class="componentSwitchHex">
<span class="codeHex">0</span>
<ul class="seriesSwitch">
<li class="containerSwitch"></a><span class="indicationDigit">128</span><a class="contentSwitch on" href="javascript:void(0);"></a></li>
<li class="containerSwitch"></a><span class="indicationDigit">64</span><a class="contentSwitch on" href="javascript:void(0);"></a></li>
<li class="containerSwitch"></a><span class="indicationDigit">32</span><a class="contentSwitch on" href="javascript:void(0);"></a></li>
<li class="containerSwitch"></a><span class="indicationDigit">16</span><a class="contentSwitch on" href="javascript:void(0);"></a></li>
<li class="containerSwitch"></a><span class="indicationDigit">8</span><a class="contentSwitch on" href="javascript:void(0);"></a></li>
<li class="containerSwitch"></a><span class="indicationDigit">4</span><a class="contentSwitch on" href="javascript:void(0);"></a></li>
<li class="containerSwitch"></a><span class="indicationDigit">2</span><a class="contentSwitch on" href="javascript:void(0);"></a></li>
<li class="containerSwitch"></a><span class="indicationDigit">1</span><a class="contentSwitch on" href="javascript:void(0);"></a></li>
</ul>
</div>
<!-- /containerBitWithIncDec --></div>
<!-- /crusterSwitch --> </div>


<div class="crusterSwitch valueTo">
<div class="containerBitWithIncDec">
<div class="componentSwitchHex">
<span class="codeHex">0</span>
<ul class="seriesSwitch">
<li class="containerSwitch"><a class="contentSwitch" href="javascript:void(0);"></a></li>
<li class="containerSwitch"><a class="contentSwitch" href="javascript:void(0);"></a></li>
<li class="containerSwitch"><a class="contentSwitch" href="javascript:void(0);"></a></li>
<li class="containerSwitch"><a class="contentSwitch" href="javascript:void(0);"></a></li>
<li class="containerSwitch"><a class="contentSwitch" href="javascript:void(0);"></a></li>
<li class="containerSwitch"><a class="contentSwitch" href="javascript:void(0);"></a></li>
<li class="containerSwitch"><a class="contentSwitch" href="javascript:void(0);"></a></li>
<li class="containerSwitch"><a class="contentSwitch on" href="javascript:void(0);"></a></li>
</ul>
</div>
<!-- /containerBitWithIncDec --></div>
<!-- /crusterSwitch --> </div>

<div class="containerSignCalc"><span class="containerParticle"><a class="contentSignCalc signPlus" href="javascript:void(0);">+</a></span></div>

<div class="crusterSwitch result">
<div class="containerBitWithIncDec">
<div class="componentSwitchHex">
<span class="codeHex">0</span>
<ul class="seriesSwitch">
<li class="containerSwitch"><a class="contentSwitch" href="javascript:void(0);"></a><span class="indicationDigit">256</span></li>
<li class="containerSwitch"><a class="contentSwitch" href="javascript:void(0);"></a><span class="indicationDigit">128</span></li>
<li class="containerSwitch"><a class="contentSwitch" href="javascript:void(0);"></a><span class="indicationDigit">64</span></li>
<li class="containerSwitch"><a class="contentSwitch" href="javascript:void(0);"></a><span class="indicationDigit">32</span></li>
<li class="containerSwitch"><a class="contentSwitch" href="javascript:void(0);"></a><span class="indicationDigit">16</span></li>
<li class="containerSwitch"><a class="contentSwitch" href="javascript:void(0);"></a><span class="indicationDigit">8</span></li>
<li class="containerSwitch"><a class="contentSwitch" href="javascript:void(0);"></a><span class="indicationDigit">4</span></li>
<li class="containerSwitch"><a class="contentSwitch" href="javascript:void(0);"></a><span class="indicationDigit">2</span></li>
<li class="containerSwitch"><a class="contentSwitch" href="javascript:void(0);"></a><span class="indicationDigit">1</span></li>
</ul>
</div>
<!-- /containerBitWithIncDec --></div>
<!-- /crusterSwitch --> </div>

<script>
;(function() {
  document.addEventListener('DOMContentLoaded', () => {
    const settings = {
      waitBitTransition: 100,
      classnameTurnedOn: 'on'
    };
    const seriesBitResult = Array.from(document.querySelectorAll('.result'));
    const signPlus = document.querySelector('.signPlus');
    const seriesValue = Array.from(document.querySelectorAll('.codeHex'));

    const seriesBunchOfBit = Array.from(document.querySelectorAll('.componentSwitchHex'));
    const bunchOfBitAdded = Array.from(seriesBunchOfBit[0].querySelectorAll('.contentSwitch'));
    const bunchOfBitAdd = Array.from(seriesBunchOfBit[1].querySelectorAll('.contentSwitch'));
    const bunchOfBitResult = Array.from(seriesBunchOfBit[2].querySelectorAll('.contentSwitch'));

    signPlus.addEventListener('click', (ev) => {
      swellBounce(signPlus);
      fireParticle(signPlus);

      bunchOfBitResult.forEach((bitResult) => {
        bitResult.classList.remove(settings.classnameTurnedOn);
      });

      // +++++++++++++++++++++++++++++++ ビット演算を展開
      // push, popは使わずインデックス参照でやる
      const ixLowerEndCalculated = bunchOfBitAdded.length - 1;

      let ixBitResult, digitAdded, digitAdd, digitCarry, xorAddedAdd;

      for(let ix = ixLowerEndCalculated; ix >= 0; ix --) {
        setTimeout(() => { // setTimeout コマ送り動作
          ixBitResult = ix + 1;

          digitAdded = bunchOfBitAdded[ix].classList.contains(settings.classnameTurnedOn);
          digitAdd = bunchOfBitAdd[ix].classList.contains(settings.classnameTurnedOn);
          digitCarry = bunchOfBitResult[ixBitResult].classList.contains(settings.classnameTurnedOn);

          // 対象二項のXOR判定
          xorAddedAdd = (digitAdded ^ digitAdd) ? true : false;
          // 繰り上げが伝達されている場合は反転
          resultBitCurrent = (xorAddedAdd ^ digitCarry) ? true : false;

          // 当該桁の結果描画
          if(resultBitCurrent) {
            bunchOfBitResult[ixBitResult].classList.add(settings.classnameTurnedOn);
          }
          else {
            bunchOfBitResult[ixBitResult].classList.remove(settings.classnameTurnedOn);
          }

          fireParticle(bunchOfBitResult[ixBitResult]);

          // 繰り上げを一位上の桁にストア（一時的に描画）
          if(((digitAdded && !digitAdd) || (!digitAdded && digitAdd)) && digitCarry) {
            bunchOfBitResult[ixBitResult -1].classList.add(settings.classnameTurnedOn);

            // 最上位に繰り上がるときはパーティクルを発生
            if(ixBitResult -1 === 0) {
              setTimeout(() => {
                fireParticle(bunchOfBitResult[ixBitResult - 1]);
              }, settings.waitBitTransition);
            }
          }
          if((digitAdded && digitAdd)) {
            bunchOfBitResult[ixBitResult -1].classList.add(settings.classnameTurnedOn);

            if(ixBitResult -1 === 0) {
              setTimeout(() => {
                fireParticle(bunchOfBitResult[ixBitResult - 1]);
              }, settings.waitBitTransition);
            }
          }
        }, settings.waitBitTransition * ((bunchOfBitResult.length - 1) - (ix + 1)));
      }
    });
  });
})();
</script>
<!-- /demoAddition --> </main>
<!-- /appdemoBinarySwitch --></div>


</body>
</html>
